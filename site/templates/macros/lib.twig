{% macro img(image, params = []) %}

    {% set width = params.transform.width ?? null %}

    {% if params.transform.ratio is defined and params.transform.ratio.isNotEmpty %}
        {% set ratio = params.transform.ratio|split('/') %}
        {% set height = (width / ratio[0] * ratio[1])|round %}
    {% else %}
        {% set height = params.transform.height ?? null %}
    {% endif %}

    {% set mode = params.mode ?? 'crop' %}
    {% set loading = params.attr.loading ?? 'lazy' %}
    {% set class = params.attr.class ?? '' %}

    {% if mode == 'resize' %}
        {% set image = image.resize(width, height) %}
    {% else %}
        {% set image = image.crop(width, height) %}
    {% endif %}


    <img alt="{{ image.alt }}"
         class="{{ class }}"
         src="{{ image.url }}"
         width="{{ image.width }}"
         height="{{ image.height }}"
            {{ loading ? 'loading="lazy"' }}
    >
{% endmacro %}